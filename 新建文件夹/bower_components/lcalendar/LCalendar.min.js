window.LCalendar=function(){var a=function(){this.gearDate,this.minY=1900,this.minM=1,this.minD=1,this.maxY=2099,this.maxM=12,this.maxD=31,this.clickFn};return a.prototype={init:function(a){var b,c,d,e,f,g,h;return this.type=a.type,this.trigger=document.querySelector(a.trigger),null!=this.trigger.getAttribute("data-lcalendar")&&(b=this.trigger.getAttribute("data-lcalendar").split(","),c=b[0].split("-"),this.minY=~~c[0],this.minM=~~c[1],this.minD=~~c[2],d=b[1].split("-"),this.maxY=~~d[0],this.maxM=~~d[1],this.maxD=~~d[2]),a.minDate&&(e=a.minDate.split(" "),e[1]&&(f=e[1].split(":"),this.minT=~~f[0],this.minS=~~f[1]),c=e[0].split("-"),this.minY=~~c[0],this.minM=~~c[1],this.minD=~~c[2]),a.maxDate&&(g=a.maxDate.split(" "),g[1]&&(h=g[1].split(":"),this.maxT=~~h[0],this.maxS=~~h[1]),d=g[0].split("-"),this.maxY=~~d[0],this.maxM=~~d[1],this.maxD=~~d[2]),this.bindEvent(this.type),this.callback=a.callback,this},bindEvent:function(a){function c(){var c,e,f,g,h;b.gearDate=document.createElement("div"),b.gearDate.className="gearDate",b.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="date_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd"></div><div class="date_grid"><div>日</div></div></div></div></div></div>',document.body.appendChild(b.gearDate),d(),c=b.gearDate.querySelector(".lcalendar_cancel"),c.addEventListener("touchstart",s),e=b.gearDate.querySelector(".lcalendar_finish"),e.addEventListener("touchstart",t),f=b.gearDate.querySelector(".date_yy"),g=b.gearDate.querySelector(".date_mm"),h=b.gearDate.querySelector(".date_dd"),f.addEventListener("touchstart",n),g.addEventListener("touchstart",n),h.addEventListener("touchstart",n),f.addEventListener("touchmove",o),g.addEventListener("touchmove",o),h.addEventListener("touchmove",o),f.addEventListener("touchend",p),g.addEventListener("touchend",p),h.addEventListener("touchend",p)}function d(){var a=new Date,c={yy:a.getFullYear(),mm:a.getMonth(),dd:a.getDate()-1};/^\d{4}-\d{1,2}-\d{1,2}$/.test(b.trigger.value)?(rs=b.trigger.value.match(/(^|-)\d{1,4}/g),c.yy=rs[0]-b.minY,c.mm=rs[1].replace(/-/g,"")-1,c.dd=rs[2].replace(/-/g,"")-1):c.yy=c.yy-b.minY,b.gearDate.querySelector(".date_yy").setAttribute("val",c.yy),b.gearDate.querySelector(".date_mm").setAttribute("val",c.mm),b.gearDate.querySelector(".date_dd").setAttribute("val",c.dd),k()}function e(){var c,d,e,g;b.gearDate=document.createElement("div"),b.gearDate.className="gearDate",b.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="ym_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div></div></div></div>',document.body.appendChild(b.gearDate),f(),c=b.gearDate.querySelector(".lcalendar_cancel"),c.addEventListener("touchstart",s),d=b.gearDate.querySelector(".lcalendar_finish"),d.addEventListener("touchstart",u),e=b.gearDate.querySelector(".date_yy"),g=b.gearDate.querySelector(".date_mm"),e.addEventListener("touchstart",n),g.addEventListener("touchstart",n),e.addEventListener("touchmove",o),g.addEventListener("touchmove",o),e.addEventListener("touchend",p),g.addEventListener("touchend",p)}function f(){var a=new Date,c={yy:a.getFullYear(),mm:a.getMonth()};/^\d{4}-\d{1,2}$/.test(b.trigger.value)?(rs=b.trigger.value.match(/(^|-)\d{1,4}/g),c.yy=rs[0]-b.minY,c.mm=rs[1].replace(/-/g,"")-1):c.yy=c.yy-b.minY,b.gearDate.querySelector(".date_yy").setAttribute("val",c.yy),b.gearDate.querySelector(".date_mm").setAttribute("val",c.mm),k()}function g(){var c,d,e,f,g,i,j;b.gearDate=document.createElement("div"),b.gearDate.className="gearDatetime",b.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="datetime_roll"><div><div id="calendar-yy" class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div id="calendar-mm" class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div><div><div id="calendar-dd" class="gear date_dd" data-datetype="date_dd"></div><div class="date_grid"><div>日</div></div></div><div><div id="calendar-hh" class="gear time_hh" data-datetype="time_hh"></div><div class="date_grid"><div>时</div></div></div><div><div id="calendar-ss" class="gear time_mm" data-datetype="time_mm"></div><div class="date_grid"><div>分</div></div></div></div></div></div>',document.body.appendChild(b.gearDate),h(),c=b.gearDate.querySelector(".lcalendar_cancel"),c.addEventListener("touchstart",s),d=b.gearDate.querySelector(".lcalendar_finish"),d.addEventListener("touchstart",v),e=b.gearDate.querySelector(".date_yy"),f=b.gearDate.querySelector(".date_mm"),g=b.gearDate.querySelector(".date_dd"),i=b.gearDate.querySelector(".time_hh"),j=b.gearDate.querySelector(".time_mm"),e.addEventListener("touchstart",n),f.addEventListener("touchstart",n),g.addEventListener("touchstart",n),i.addEventListener("touchstart",n),j.addEventListener("touchstart",n),e.addEventListener("touchmove",o),f.addEventListener("touchmove",o),g.addEventListener("touchmove",o),i.addEventListener("touchmove",o),j.addEventListener("touchmove",o),e.addEventListener("touchend",p),f.addEventListener("touchend",p),g.addEventListener("touchend",p),i.addEventListener("touchend",p),j.addEventListener("touchend",p)}function h(){var a=new Date,c={yy:a.getFullYear(),mm:a.getMonth(),dd:a.getDate()-1,hh:a.getHours(),mi:0};/^\d{4}-\d{1,2}-\d{1,2}\s\d{2}:\d{2}$/.test(b.trigger.value)?(rs=b.trigger.value.match(/(^|-|\s|:)\d{1,4}/g),c.yy=rs[0]-b.minY,c.mm=rs[1].replace(/-/g,"")-1,c.dd=rs[2].replace(/-/g,"")-1,c.hh=parseInt(rs[3].replace(/\s0?/g,"")),c.mi=parseInt(rs[4].replace(/:0?/g,""))):c.yy=c.yy-b.minY,b.gearDate.querySelector(".date_yy").setAttribute("val",c.yy),b.gearDate.querySelector(".date_mm").setAttribute("val",c.mm),b.gearDate.querySelector(".date_dd").setAttribute("val",c.dd),k(),b.gearDate.querySelector(".time_hh").setAttribute("val",c.hh),b.gearDate.querySelector(".time_mm").setAttribute("val",c.mi),l()}function i(){var c,d,e,f;b.gearDate=document.createElement("div"),b.gearDate.className="gearDate",b.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="time_roll"><div><div class="gear time_hh" data-datetype="time_hh"></div><div class="date_grid"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm"></div><div class="date_grid"><div>分</div></div></div></div></div></div>',document.body.appendChild(b.gearDate),j(),c=b.gearDate.querySelector(".lcalendar_cancel"),c.addEventListener("touchstart",s),d=b.gearDate.querySelector(".lcalendar_finish"),d.addEventListener("touchstart",w),e=b.gearDate.querySelector(".time_hh"),f=b.gearDate.querySelector(".time_mm"),e.addEventListener("touchstart",n),f.addEventListener("touchstart",n),e.addEventListener("touchmove",o),f.addEventListener("touchmove",o),e.addEventListener("touchend",p),f.addEventListener("touchend",p)}function j(){var a=new Date,c={hh:a.getHours(),mm:a.getMinutes()};/^\d{2}:\d{2}$/.test(b.trigger.value)&&(rs=b.trigger.value.match(/(^|:)\d{2}/g),c.hh=parseInt(rs[0].replace(/^0?/g,"")),c.mm=parseInt(rs[1].replace(/:0?/g,""))),b.gearDate.querySelector(".time_hh").setAttribute("val",c.hh),b.gearDate.querySelector(".time_mm").setAttribute("val",c.mm),l()}function k(){var e,f,g,h,i,j,k,l,n,o,p,q,r,a=b.maxY-b.minY+1,c=b.gearDate.querySelector(".date_yy"),d="";if(c&&c.getAttribute("val")){for(e=parseInt(c.getAttribute("val")),f=0;a-1>=f;f++)d+="<div class='tooth'>"+(b.minY+f)+"</div>";if(c.innerHTML=d,g=Math.floor(parseFloat(c.getAttribute("top"))),isNaN(g)?(c.style["-webkit-transform"]="translate3d(0,"+(8-2*e)+"em,0)",c.setAttribute("top",8-2*e+"em")):(0==g%2?g=g:g+=1,g>8&&(g=8),h=8-2*(a-1),h>g&&(g=h),c.style["-webkit-transform"]="translate3d(0,"+g+"em,0)",c.setAttribute("top",g+"em"),e=Math.abs(g-8)/2,c.setAttribute("val",e)),i=b.gearDate.querySelector(".date_mm"),i&&i.getAttribute("val")){for(d="",j=parseInt(i.getAttribute("val")),k=11,l=0,e==a-1&&(b.isMaxY=!0,k=b.maxM-1),0==e&&(b.isMinY=!0,l=b.minM-1),f=0;k-l+1>f;f++)d+="<div class='tooth'>"+(l+f+1)+"</div>";if(i.innerHTML=d,j>k?(j=k,i.setAttribute("val",j)):l>j&&(j=k,i.setAttribute("val",j)),i.style["-webkit-transform"]="translate3d(0,"+(8-2*(j-l))+"em,0)",i.setAttribute("top",8-2*(j-l)+"em"),n=b.gearDate.querySelector(".date_dd"),n&&n.getAttribute("val")){for(d="",o=parseInt(n.getAttribute("val")),p=m(e,j),q=p-1,r=0,e==a-1&&b.maxM==j+1&&(b.isMaxYM=!0,q=b.maxD-1),0==e&&b.minM==j+1&&(b.isMinYM=!0,r=b.minD-1),f=0;q-r+1>f;f++)d+="<div class='tooth'>"+(r+f+1)+"</div>";n.innerHTML=d,o>q?(o=q,n.setAttribute("val",o)):r>o&&(o=r,n.setAttribute("val",o)),n.style["-webkit-transform"]="translate3d(0,"+(8-2*(o-r))+"em,0)",n.setAttribute("top",8-2*(o-r)+"em")}}}}function l(){var f,g,h,i,j,k,l,a=b.gearDate.querySelector(".time_hh"),c=23,d=0,e=parseInt(b.gearDate.querySelector(".date_dd").getAttribute("val"))+1;if(e==b.maxD&&b.isMaxYM===!0&&(b.isMaxYMD=!0,c=b.maxT),e==b.minD&&b.isMinYM===!0&&(b.isMinYMD=!0,d=b.minT),a&&a.getAttribute("val")){for(f="",g=parseInt(a.getAttribute("val")),g=g>c?c:g,g=d>g?d:g,a.setAttribute("val",g),h=d;c>=h;h++)f+="<div class='tooth'>"+h+"</div>";if(""===f&&(f="<div class='tooth'>"+g+"</div>"),a.innerHTML=f,a.style["-webkit-transform"]="translate3d(0,"+(8-2*(g-d))+"em,0)",a.setAttribute("top",8-2*(g-d)+"em"),i=59,j=0,g==c&&b.isMaxYMD===!0&&(i=b.maxS),g==d&&b.isMinYMD===!0&&(j=b.minS),k=b.gearDate.querySelector(".time_mm"),k&&k.getAttribute("val")){for(f="",l=parseInt(k.getAttribute("val")),l=0==l?0:10>=l?10:20>=l?20:30>=l?30:40>=l?40:50>=l?50:50,l=l>i?i:l,l=j>l?j:l,k.setAttribute("val",l),b.mmNum=0,b.mmValArr=[],h=j;i>=h;h+=10)f+=0===h?"<div class='tooth'>00</div>":"<div class='tooth'>"+h+"</div>",b.mmNum++,b.mmValArr.push(h);k.innerHTML=f,k.style["-webkit-transform"]="translate3d(0,"+(8-2*(l-j)/10)+"em,0)",k.setAttribute("top",8-2*(l-j)/10+"em")}}}function m(a,c){return 1==c?(a+=b.minY,0==a%4&&0!=a%100||0==a%400&&0!=a%4e3?29:28):3==c||5==c||8==c||10==c?30:31}function n(a){var b,c;for(a.preventDefault(),b=a.target;;){if(b.classList.contains("gear"))break;b=b.parentElement}clearInterval(b["int_"+b.id]),b["old_"+b.id]=a.targetTouches[0].screenY,b["o_t_"+b.id]=(new Date).getTime(),c=b.getAttribute("top"),b["o_d_"+b.id]=c?parseFloat(c.replace(/em/g,"")):0,b.style.webkitTransitionDuration=b.style.transitionDuration="0ms"}function o(a){var b,c;for(a.preventDefault(),b=a.target;;){if(b.classList.contains("gear"))break;b=b.parentElement}b["new_"+b.id]=a.targetTouches[0].screenY,b["n_t_"+b.id]=(new Date).getTime(),c=30*(b["new_"+b.id]-b["old_"+b.id])/window.innerHeight,b["pos_"+b.id]=b["o_d_"+b.id]+c,b.style["-webkit-transform"]="translate3d(0,"+b["pos_"+b.id]+"em,0)",b.setAttribute("top",b["pos_"+b.id]+"em"),a.targetTouches[0].screenY<1&&p(a)}function p(a){var b,c;for(a.preventDefault(),b=a.target;;){if(b.classList.contains("gear"))break;b=b.parentElement}c=(b["new_"+b.id]-b["old_"+b.id])/(b["n_t_"+b.id]-b["o_t_"+b.id]),isNaN(c)&&(c=0),b["spd_"+b.id]=Math.abs(c)<=.2?0>c?-.08:.08:Math.abs(c)<=.5?0>c?-.16:.16:c/2,b["pos_"+b.id]||(b["pos_"+b.id]=0),q(b)}function q(a){function e(){a.style.webkitTransitionDuration=a.style.transitionDuration="200ms",d=!0}var c=0,d=!1,f=b.maxY-b.minY+1;clearInterval(a["int_"+a.id]),a["int_"+a.id]=setInterval(function(){var i,j,k,l,n,o,p,q,s,t,u,v,w,x,y,z,A,B,C,g=a["pos_"+a.id],h=a["spd_"+a.id]*Math.exp(-.03*c);switch(g+=h,Math.abs(h)>.1||(i=2*Math.round(g/2),g=i,e()),g>8&&(g=8,e()),a.dataset.datetype){case"date_yy":j=8-2*(f-1),j>g&&(g=j,e()),d&&(k=Math.abs(g-8)/2,r(a,k),clearInterval(a["int_"+a.id]));break;case"date_mm":l=b.gearDate.querySelector(".date_yy"),n=parseInt(l.getAttribute("val")),o=11,p=0,n==f-1&&(o=b.maxM-1),0==n&&(p=b.minM-1),j=8-2*(o-p),j>g&&(g=j,e()),d&&(k=Math.abs(g-8)/2+p,r(a,k),clearInterval(a["int_"+a.id]));break;case"date_dd":l=b.gearDate.querySelector(".date_yy"),q=b.gearDate.querySelector(".date_mm"),n=parseInt(l.getAttribute("val")),s=parseInt(q.getAttribute("val")),t=m(n,s),u=t-1,v=0,n==f-1&&b.maxM==s+1&&(u=b.maxD-1),0==n&&b.minM==s+1&&(v=b.minD-1),j=8-2*(u-v),j>g&&(g=j,e()),d&&(k=Math.abs(g-8)/2+v,r(a,k),clearInterval(a["int_"+a.id]));break;case"time_hh":q=b.gearDate.querySelector(".date_dd"),w=parseInt(q.getAttribute("val"))+1,x=0,y=23,w==b.maxD&&(y=b.maxT),w==b.minD&&(x=b.minT),j=8-2*(y-x),j>g&&(g=j,e()),d&&(k=Math.abs(g-8)/2+x,r(a,k),clearInterval(a["int_"+a.id]));break;case"time_mm":z=0,A=b.gearDate.querySelector(".time_hh"),B=parseInt(A.getAttribute("val")),B==b.minT&&(z=b.minS),C=10-2*b.mmNum,C>g&&(g=C,e()),d&&(k=10*(Math.abs(g-8)/2)+z,r(a,k),clearInterval(a["int_"+a.id]))}a["pos_"+a.id]=g,a.style["-webkit-transform"]="translate3d(0,"+g+"em,0)",a.setAttribute("top",g+"em"),c++},30)}function r(a,c){b.isMinYMD=!1,b.isMaxYMD=!1,c=Math.round(c),a.setAttribute("val",c),/date/.test(a.dataset.datetype)?(b.isMinYM=!1,b.isMaxYM=!1,k(),l()):l()}function s(a){var h,c=b.gearDate.querySelector(".date_yy"),d=b.gearDate.querySelector(".date_mm"),e=b.gearDate.querySelector(".date_dd"),f=b.gearDate.querySelector(".time_hh"),g=b.gearDate.querySelector(".time_mm");c&&clearInterval(c["int_"+c.id]),d&&clearInterval(d["int_"+d.id]),e&&clearInterval(e["int_"+e.id]),f&&clearInterval(f["int_"+f.id]),g&&clearInterval(g["int_"+g.id]),a.preventDefault();try{h=new CustomEvent("input")}catch(a){h=document.createEvent("Event"),h.initEvent("input",!0,!0)}b.trigger.dispatchEvent(h),document.body.removeChild(b.gearDate),b.gearDate=null}function t(a){var c,d,e,f;!b.gearDate,c=b.maxY-b.minY+1,d=parseInt(Math.round(b.gearDate.querySelector(".date_yy").getAttribute("val"))),e=parseInt(Math.round(b.gearDate.querySelector(".date_mm").getAttribute("val")))+1,e=e>9?e:"0"+e,f=parseInt(Math.round(b.gearDate.querySelector(".date_dd").getAttribute("val")))+1,f=f>9?f:"0"+f,b.callback(d%c+b.minY+"-"+e+"-"+f),s(a)}function u(a){var c,d,e;return b.gearDate?(c=b.maxY-b.minY+1,d=parseInt(Math.round(b.gearDate.querySelector(".date_yy").getAttribute("val"))),e=parseInt(Math.round(b.gearDate.querySelector(".date_mm").getAttribute("val")))+1,e=e>9?e:"0"+e,b.callback(d%c+b.minY+"-"+e),s(a),void 0):(s(a),void 0)}function v(a){var c,d,e,f,g,h;return b.gearDate?(c=b.maxY-b.minY+1,d=parseInt(Math.round(b.gearDate.querySelector(".date_yy").getAttribute("val"))),e=parseInt(Math.round(b.gearDate.querySelector(".date_mm").getAttribute("val")))+1,e=e>9?e:"0"+e,f=parseInt(Math.round(b.gearDate.querySelector(".date_dd").getAttribute("val")))+1,f=f>9?f:"0"+f,g=parseInt(Math.round(b.gearDate.querySelector(".time_hh").getAttribute("val"))),g=g>9?g:"0"+g,h=parseInt(Math.round(b.gearDate.querySelector(".time_mm").getAttribute("val"))),h=h>9?h:"0"+h,b.callback(d%c+b.minY+"-"+e+"-"+f+" "+(g.length<2?"0":"")+g+(h.length<2?":0":":")+h),s(a),void 0):(s(a),void 0)}function w(a){var c,d;return b.gearDate?(c=parseInt(Math.round(b.gearDate.querySelector(".time_hh").getAttribute("val"))),c=c>9?c:"0"+c,d=parseInt(Math.round(b.gearDate.querySelector(".time_mm").getAttribute("val"))),d=d>9?d:"0"+d,b.callback((c.length<2?"0":"")+c+(d.length<2?":0":":")+d),s(a),void 0):(s(a),void 0)}var b=this;b.clickFn=function(){switch(a){case"ym":e();break;case"date":c();break;case"datetime":g();break;case"time":i()}},b.trigger.addEventListener("click",b.clickFn)}},a}();